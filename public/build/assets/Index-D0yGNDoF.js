import{r as m,c as L,a as c,o as i,b as p,d as O,w as I,e,t as u,n as z,u as W,f as Q,g as X,h as E,i as Y,F as D,j as K,k as Z,l as ee}from"./app-DLRClR93.js";import{A as te}from"./AuthenticatedLayout-X2c9acdw.js";import{_ as B}from"./Card.vue_vue_type_script_setup_true_lang-BPYeHnK8.js";import{u as q,C as ae}from"./attendanceState-6fp9wDvG.js";import{_ as se}from"./Button.vue_vue_type_script_setup_true_lang-BEwuWev6.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Modal-C8rpBJy6.js";const oe={class:"attendance-action"},ne={class:"flex items-center justify-center space-x-2"},re={key:0,class:"animate-spin h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ie={key:1,class:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},le={key:0,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"},ce={key:1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"},de={key:0,class:"mt-2 text-sm text-red-600 text-center"},ue={key:1,class:"mt-3 text-sm text-gray-600 text-center"},me={class:"font-medium"},he={class:"text-xs"},pe={__name:"AttendanceAction",props:{action:{type:String,required:!0,validator:k=>["checkin","checkout"].includes(k)},disabled:{type:Boolean,default:!1},outlet:{type:Object,default:null}},emits:["success","error"],setup(k,{emit:v}){const d=k,_=v,{canCheckIn:R,canCheckOut:M}=q(),y=m(!1),x=m(!1),w=m("idle"),C=m(""),f=L(()=>d.action==="checkin"?"Check In":"Check Out"),g=L(()=>d.action==="checkin"?"bg-green-600 hover:bg-green-700":"bg-blue-600 hover:bg-blue-700");L(()=>w.value==="success");const S=L(()=>d.action==="checkin"?R.value&&!d.disabled:d.action==="checkout"?M.value&&!d.disabled:!1),$=async()=>{if(w.value==="getting")return null;w.value="getting",C.value="";try{const l=await new Promise((h,r)=>{if(!navigator.geolocation){r(new Error("Geolocation tidak didukung"));return}navigator.geolocation.getCurrentPosition(h,r,{enableHighAccuracy:!0,timeout:15e3,maximumAge:6e4})});return w.value="success",l}catch(l){throw w.value="error",C.value=l.message,l}},P=async l=>{var h;if(!x.value){x.value=!0;try{const r=await $(),b=new FormData;b.append("latitude",r.coords.latitude),b.append("longitude",r.coords.longitude),b.append("accuracy",r.coords.accuracy),b.append("selfie",l,`selfie_${Date.now()}.jpg`);const V=d.action==="checkin"?"/attendance/checkin":"/attendance/checkout",T=await axios.post(V,b,{headers:{"Content-Type":"multipart/form-data"}});if(T.data.success)(h=window.enhancedErrorHandler)==null||h.resetRetries(d.action),_("success",{message:`${f.value} berhasil!`,data:T.data});else throw new Error(T.data.message)}catch(r){window.enhancedErrorHandler?await window.enhancedErrorHandler.handleError(r,null,{action:d.action,retryCallback:()=>P(l)})||_("error",{message:r.message||"Gagal melakukan "+f.value.toLowerCase(),error:r}):_("error",{message:r.message||"Gagal melakukan "+f.value.toLowerCase(),error:r})}finally{x.value=!1}}},j=l=>{y.value=!1,P(l)},G=l=>{y.value=!1,_("error",{message:"Gagal mengakses kamera: "+l.message,error:l})},H=()=>{d.disabled||x.value||!S.value||(y.value=!0)};return(l,h)=>(i(),c("div",oe,[p(se,{onClick:H,disabled:k.disabled||x.value||!S.value,class:z([g.value,"w-full py-3 text-lg font-semibold"])},{default:I(()=>[e("div",ne,[x.value?(i(),c("svg",re,[...h[1]||(h[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(i(),c("svg",ie,[k.action==="checkin"?(i(),c("path",le)):(i(),c("path",ce))])),e("span",null,u(x.value?"Memproses...":f.value),1)])]),_:1},8,["disabled","class"]),w.value==="error"?(i(),c("div",de,u(C.value),1)):O("",!0),k.outlet?(i(),c("div",ue,[e("div",me,u(k.outlet.name),1),e("div",he,u(k.outlet.formatted_operational_hours),1)])):O("",!0),p(ae,{show:y.value,title:`Ambil Foto ${f.value}`,onClose:h[0]||(h[0]=r=>y.value=!1),onCapture:()=>{},onConfirm:j,onError:G},null,8,["show","title"])]))}},U=J(pe,[["__scopeId","data-v-43065205"]]),ke={class:"py-12"},xe={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},fe={class:"mb-8"},ge={class:"mt-2 text-muted"},ve={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},_e={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"},we={class:"p-6"},be={class:"flex items-center"},ye={class:"ml-4"},Ce={class:"text-2xl font-bold text-text"},Ae={class:"p-6"},Ee={class:"flex items-center"},Me={class:"ml-4"},Se={class:"text-2xl font-bold text-text"},Ie={class:"p-6"},$e={class:"flex items-center"},He={class:"ml-4"},Te={class:"text-2xl font-bold text-text"},Pe={class:"p-6"},Le={class:"overflow-x-auto"},De={class:"min-w-full divide-y divide-border"},Be={class:"bg-surface-1 divide-y divide-border"},Oe={class:"px-6 py-4 whitespace-nowrap text-sm text-text"},Re={class:"px-6 py-4 whitespace-nowrap text-sm text-text"},je={class:"px-6 py-4 whitespace-nowrap text-sm text-text"},Ge={class:"px-6 py-4 whitespace-nowrap text-sm text-text"},Ve={class:"px-6 py-4 whitespace-nowrap"},ze={key:0,class:"mt-6 flex justify-center"},Fe=["innerHTML"],Ne={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ke={__name:"Index",setup(k){const v=W(),d=m(v.props.attendances),_=m(v.props.stats),{todayAttendance:R,outlet:M,canCheckIn:y,canCheckOut:x,fetchAttendanceStatus:w}=q();m(!1);const C=m(""),f=m(!1),g=m(""),S=m(null),$=m(!1),P=a=>{S.value=a},j=async a=>{$.value=!0,f.value=!1,C.value="";const t=async()=>{try{const o=await H(),n=new FormData;n.append("latitude",o.coords.latitude),n.append("longitude",o.coords.longitude),n.append("accuracy",o.coords.accuracy),n.append("selfie",a,`selfie_${Date.now()}.jpg`);const s=g.value==="checkin"?"/attendance/checkin":"/attendance/checkout",A=await axios.post(s,n,{headers:{"Content-Type":"multipart/form-data"}});A.data.success?(window.enhancedErrorHandler.resetRetries(g.value),handleSuccess(g.value==="checkin"?"Check-in berhasil!":"Check-out berhasil!"),window.location.reload()):handleError(new Error(A.data.message))}catch(o){console.error("Attendance error:",o),await window.enhancedErrorHandler.handleError(o,null,{action:g.value,retryCallback:t})||h(o)}};await t(),$.value=!1,S.value=null,g.value=""},G=()=>{f.value=!1,S.value=null,g.value=""},H=(a=0)=>new Promise((t,o)=>{if(!navigator.geolocation){o(new Error("Geolocation tidak didukung pada browser ini. Silakan gunakan browser modern."));return}const n={enableHighAccuracy:!0,timeout:2e4,maximumAge:6e4};navigator.geolocation.getCurrentPosition(s=>{console.log("Location obtained:",{latitude:s.coords.latitude,longitude:s.coords.longitude,accuracy:s.coords.accuracy}),t(s)},s=>{console.error("Geolocation error:",s),l(s,t,o,a)},n)}),l=(a,t,o,n)=>{switch(a.code){case a.PERMISSION_DENIED:o(new Error("Akses lokasi ditolak. Silakan aktifkan izin lokasi di pengaturan browser Anda."));break;case a.POSITION_UNAVAILABLE:n<1?(console.log(`Retrying location fetch... Attempt ${n+1}`),setTimeout(()=>{H(n+1).then(t).catch(o)},2e3)):o(new Error("Informasi lokasi tidak tersedia. Periksa layanan GPS/lokasi Anda dan coba lagi."));break;case a.TIMEOUT:n<1?(console.log(`Location timeout, retrying... Attempt ${n+1}`),setTimeout(()=>{H(n+1).then(t).catch(o)},3e3)):o(new Error("Permintaan lokasi timeout. Pastikan Anda memiliki koneksi internet stabil dan coba lagi."));break;default:o(new Error("Terjadi kesalahan tidak diketahui saat mendapatkan lokasi Anda. Silakan coba lagi."));break}},h=a=>{let t="Gagal mendapatkan lokasi. ";a.message?t+=a.message:t+="Pastikan layanan lokasi aktif dan Anda telah memberikan izin.",C.value=t,setTimeout(()=>{C.value+=`

Tips troubleshooting:
• Pastikan layanan lokasi aktif di perangkat Anda
• Berikan izin lokasi ke website ini
• Coba refresh halaman dan coba lagi
• Jika di dalam ruangan, coba mendekati jendela
• Periksa koneksi internet Anda`},1e3)},r=a=>a?new Date(a).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}):"-",b=a=>a?new Date(a).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"-",V=a=>{switch(a){case"checked_in":return"bg-success-100 text-success";case"checked_out":return"bg-info-100 text-info";default:return"bg-surface-3 text-text-3"}},T=a=>{switch(a){case"checked_in":return"Checked In";case"checked_out":return"Checked Out";default:return"Unknown"}},F=a=>{w()},N=a=>{console.error("Attendance error:",a)};return Q(()=>{v.props.todayAttendance&&(R.value=v.props.todayAttendance),v.props.outlet&&(M.value=v.props.outlet)}),(a,t)=>{const o=X("CameraModal");return i(),c(D,null,[p(E(Y),{title:"Absensi"}),p(te,null,{default:I(()=>{var n;return[e("div",ke,[e("div",xe,[e("div",fe,[t[0]||(t[0]=e("h1",{class:"text-3xl font-bold text-text"},"Absensi",-1)),e("p",ge," Kelola kehadiran Anda di "+u(((n=E(M))==null?void 0:n.name)||"Outlet"),1)]),e("div",ve,[p(U,{action:"checkin",disabled:!E(y),outlet:E(M),onSuccess:F,onError:N},null,8,["disabled","outlet"]),p(U,{action:"checkout",disabled:!E(x),outlet:E(M),onSuccess:F,onError:N},null,8,["disabled","outlet"])]),e("div",_e,[p(B,null,{default:I(()=>[e("div",we,[e("div",be,[t[2]||(t[2]=e("div",{class:"flex-shrink-0 bg-primary-100 rounded-lg p-3"},[e("svg",{class:"w-6 h-6 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",ye,[t[1]||(t[1]=e("p",{class:"text-sm font-medium text-muted"}," Total Kehadiran ",-1)),e("p",Ce,u(_.value.total_attendances),1)])])])]),_:1}),p(B,null,{default:I(()=>[e("div",Ae,[e("div",Ee,[t[4]||(t[4]=e("div",{class:"flex-shrink-0 bg-info-100 rounded-lg p-3"},[e("svg",{class:"w-6 h-6 text-info",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})])],-1)),e("div",Me,[t[3]||(t[3]=e("p",{class:"text-sm font-medium text-muted"}," Bulan Ini ",-1)),e("p",Se,u(_.value.this_month),1)])])])]),_:1}),p(B,null,{default:I(()=>[e("div",Ie,[e("div",$e,[t[6]||(t[6]=e("div",{class:"flex-shrink-0 bg-success-100 rounded-lg p-3"},[e("svg",{class:"w-6 h-6 text-success",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",He,[t[5]||(t[5]=e("p",{class:"text-sm font-medium text-muted"}," Tepat Waktu ",-1)),e("p",Te,u(_.value.on_time),1)])])])]),_:1})]),p(B,null,{default:I(()=>[e("div",Pe,[t[8]||(t[8]=e("h2",{class:"text-xl font-bold text-text mb-4"}," Riwayat Kehadiran ",-1)),e("div",Le,[e("table",De,[t[7]||(t[7]=e("thead",{class:"bg-surface-2"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-text-3 uppercase tracking-wider"}," Tanggal "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-text-3 uppercase tracking-wider"}," Check In "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-text-3 uppercase tracking-wider"}," Check Out "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-text-3 uppercase tracking-wider"}," Outlet "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-text-3 uppercase tracking-wider"}," Status ")])],-1)),e("tbody",Be,[(i(!0),c(D,null,K(d.value.data,s=>{var A;return i(),c("tr",{key:s.id},[e("td",Oe,u(b(s.created_at)),1),e("td",Re,u(r(s.check_in_time)),1),e("td",je,u(r(s.check_out_time)),1),e("td",Ge,u(((A=s.outlet)==null?void 0:A.name)||"-"),1),e("td",Ve,[e("span",{class:z(["inline-flex px-2 py-1 text-xs font-semibold rounded-full",V(s.status)])},u(T(s.status)),3)])])}),128))])])]),d.value.links?(i(),c("div",ze,[(i(!0),c(D,null,K(d.value.links,(s,A)=>(i(),c(D,{key:A},[s.url?(i(),Z(E(ee),{key:0,href:s.url,class:z(["px-3 py-2 mx-1 text-sm rounded-md",s.active?"bg-primary text-white":"bg-surface-1 text-text border border-border hover:bg-surface-2"]),innerHTML:s.label},null,8,["href","class","innerHTML"])):(i(),c("span",{key:1,class:"px-3 py-2 mx-1 text-sm text-muted",innerHTML:s.label},null,8,Fe))],64))),128))])):O("",!0)])]),_:1})])]),p(o,{show:f.value,title:g.value==="checkin"?"Ambil Foto Check-in":"Ambil Foto Check-out",onClose:G,onCapture:P,onConfirm:j},null,8,["show","title"]),$.value?(i(),c("div",Ne,[...t[9]||(t[9]=[e("div",{class:"bg-surface-1 rounded-lg p-6 flex items-center space-x-4"},[e("svg",{class:"animate-spin h-6 w-6 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})]),e("span",{class:"text-text"},"Memproses...")],-1)])])):O("",!0)]}),_:1})],64)}}},Ze=J(Ke,[["__scopeId","data-v-f8dafad2"]]);export{Ze as default};
