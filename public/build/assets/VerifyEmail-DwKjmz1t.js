import{u as C,r as u,f as S,a as l,b as k,e as s,h as T,i as N,z as I,d as _,n as q,t as h,v as b,A as x,w as z,q as B,l as M,F,B as R,o as i}from"./app-Bz8NXQHf.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $={class:"min-h-screen bg-canvas flex items-center justify-center px-4 text-text"},A={class:"max-w-md w-full rounded-2xl border border-border/80 bg-surface-1 p-8 shadow-xl"},L={key:1},j={class:"mb-6"},D=["disabled"],H={key:0},G={key:1},J={key:2},K={class:"mb-4"},Q={class:"mb-4"},W={class:"mb-4"},X={class:"mb-6"},Y={class:"space-y-3"},Z=["disabled"],ee={key:0},se={key:1},te={key:3,class:"mt-6"},ae={class:"bg-success/10 border border-success/30 rounded-lg p-4"},oe={class:"flex items-center justify-center space-x-2"},re={class:"text-success text-sm font-medium"},le={key:4,class:"mt-4 text-center"},ie=["disabled"],ne={key:0},de={key:1},ue={class:"mt-4 text-center"},ce={__name:"VerifyEmail",setup(ve){const c=C().props,n=u(c.email||""),m=u(""),f=u(""),g=u(""),y=u(!!c.email),d=u(!1),a=u(c.message||""),r=u(c.messageType||(c.message?"success":"")),p=u(c.otpInfo||null),v=u(0);let w=null;S(()=>{c.message&&(r.value="success",setTimeout(()=>{a.value=""},5e3))});const O=async()=>{if(!n.value){a.value="Please enter your email address",r.value="error";return}d.value=!0;try{const t=await axios.post(route("verification.otp.send"),{email:n.value});y.value=!0,a.value="OTP sent to your email address",r.value="success"}catch(t){t.response&&t.response.data?t.response.data.cooldown?(v.value=t.response.data.remainingSeconds,P(),a.value=`Please wait ${t.response.data.remainingSeconds} seconds before requesting a new OTP`):a.value=t.response.data.message||"Failed to send OTP":a.value="Network error. Please try again.",r.value="error"}finally{d.value=!1}},V=async()=>{d.value=!0;try{const t=await axios.post(route("verification.otp.send"),{email:n.value});t.data.cooldown?(v.value=t.data.remainingSeconds,P(),a.value=`Please wait ${t.data.remainingSeconds} seconds before requesting a new OTP`):(a.value="New OTP sent to your email address",r.value="success",window.location.reload())}catch(t){t.response&&t.response.data?a.value=t.response.data.message||"Failed to resend OTP":a.value="Network error. Please try again.",r.value="error"}finally{d.value=!1}},P=()=>{w&&clearInterval(w),w=setInterval(()=>{v.value>0?v.value--:clearInterval(w)},1e3)},E=async()=>{if(!n.value||!m.value||!f.value){a.value="Please fill all fields",r.value="error";return}if(f.value!==g.value){a.value="Passwords do not match",r.value="error";return}d.value=!0;try{const t=await axios.post(route("verification.otp.verify"),{email:n.value,otp:m.value,password:f.value,password_confirmation:g.value});a.value="Email verified successfully! Redirecting...",r.value="success",setTimeout(()=>{R.visit(route("dashboard"),{method:"get",preserveState:!1,onSuccess:()=>{console.log("Successfully redirected to dashboard")},onError:e=>{console.error("Redirect failed:",e),a.value="Redirect failed. Please try again.",r.value="error"}})},1500)}catch(t){if(t.response&&t.response.data)if(t.response.data.errors){const e=t.response.data.errors;let o="Validation errors:";e.otp&&(o+=` OTP: ${e.otp[0]}`),e.email&&(o+=` Email: ${e.email[0]}`),e.password&&(o+=` Password: ${e.password[0]}`),a.value=o}else a.value=t.response.data.message||"Invalid OTP";else a.value="Network error. Please try again.";r.value="error"}finally{d.value=!1}};return(t,e)=>(i(),l(F,null,[k(T(N),{title:"Email Verification"}),s("div",$,[s("div",A,[e[13]||(e[13]=I('<div class="text-center mb-8" data-v-3d672b29><h1 class="text-3xl font-bold text-text mb-2" style="font-family:&#39;Oswald&#39;, sans-serif;" data-v-3d672b29> Email Verification </h1><p class="text-text-2 mb-4" data-v-3d672b29> Complete your account setup to access the system </p><div class="bg-info/10 border border-info/30 rounded-lg p-4 mb-6" data-v-3d672b29><div class="flex items-start space-x-3" data-v-3d672b29><div class="flex-shrink-0" data-v-3d672b29><svg class="w-5 h-5 text-info mt-0.5" fill="currentColor" viewBox="0 0 20 20" data-v-3d672b29><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" data-v-3d672b29></path></svg></div><div class="text-left" data-v-3d672b29><h3 class="font-semibold text-text mb-1" data-v-3d672b29> First Time Login? </h3><p class="text-text-2 text-sm" data-v-3d672b29> If you were just added as an employee, you need to verify your email and set your password before logging in. </p></div></div></div></div>',1)),a.value?(i(),l("div",{key:0,class:q(["p-3 mb-4 rounded-lg border text-sm",r.value==="success"?"bg-success/10 border-success/30 text-success":"bg-error/10 border-error/30 text-error"])},h(a.value),3)):_("",!0),y.value?(i(),l("div",J,[s("div",K,[e[7]||(e[7]=s("label",{class:"block text-sm font-medium text-text mb-2"}," Email Address ",-1)),b(s("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>n.value=o),type:"email",class:"w-full rounded-lg border border-border bg-surface-2 px-3 py-2 text-text placeholder-text-muted transition duration-fast focus:border-transparent focus:outline-none focus:ring-2 focus:ring-primary-400",placeholder:"Enter your email address",required:""},null,512),[[x,n.value]])]),s("div",Q,[e[8]||(e[8]=s("label",{class:"block text-sm font-medium text-text mb-2"}," OTP Code ",-1)),b(s("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>m.value=o),type:"text",maxlength:"6",class:"w-full rounded-lg border border-border bg-surface-2 px-3 py-2 text-center text-lg font-mono tracking-[0.35em] text-text transition duration-fast focus:border-transparent focus:outline-none focus:ring-2 focus:ring-primary-400",placeholder:"000000",required:""},null,512),[[x,m.value]])]),s("div",W,[e[9]||(e[9]=s("label",{class:"block text-sm font-medium text-text mb-2"}," New Password ",-1)),b(s("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>f.value=o),type:"password",class:"w-full rounded-lg border border-border bg-surface-2 px-3 py-2 text-text placeholder-text-muted transition duration-fast focus:border-transparent focus:outline-none focus:ring-2 focus:ring-primary-400",placeholder:"Enter your new password",required:""},null,512),[[x,f.value]])]),s("div",X,[e[10]||(e[10]=s("label",{class:"block text-sm font-medium text-text mb-2"}," Confirm Password ",-1)),b(s("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>g.value=o),type:"password",class:"w-full rounded-lg border border-border bg-surface-2 px-3 py-2 text-text placeholder-text-muted transition duration-fast focus:border-transparent focus:outline-none focus:ring-2 focus:ring-primary-400",placeholder:"Confirm your new password",required:""},null,512),[[x,g.value]])]),s("div",Y,[s("button",{onClick:E,disabled:d.value||!n.value||!m.value||!f.value,class:"w-full rounded-lg bg-primary px-4 py-2 font-semibold text-white transition duration-fast hover:bg-primary-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 focus-visible:ring-offset-surface-1 disabled:cursor-not-allowed disabled:opacity-60"},[d.value?(i(),l("span",ee,"Verifying...")):(i(),l("span",se,"Verify Email & Set Password"))],8,Z),s("button",{onClick:e[5]||(e[5]=()=>{y.value=!1,a.value=""}),class:"w-full rounded-lg bg-surface-2 px-4 py-2 font-semibold text-text transition duration-fast hover:bg-surface-3 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 focus-visible:ring-offset-surface-1"}," Back to Email ")])])):(i(),l("div",L,[s("div",j,[e[6]||(e[6]=s("label",{class:"block text-sm font-medium text-text mb-2"}," Email Address ",-1)),b(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.value=o),type:"email",class:"w-full rounded-lg border border-border bg-surface-2 px-3 py-2 text-text placeholder-text-muted transition duration-fast focus:border-transparent focus:outline-none focus:ring-2 focus:ring-primary-400",placeholder:"Enter your email address",required:""},null,512),[[x,n.value]])]),s("button",{onClick:O,disabled:d.value||!n.value,class:"w-full rounded-lg bg-primary px-4 py-2 font-semibold text-white transition duration-fast hover:bg-primary-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-accent focus-visible:ring-offset-2 focus-visible:ring-offset-surface-1 disabled:cursor-not-allowed disabled:opacity-60"},[d.value?(i(),l("span",H,"Sending...")):(i(),l("span",G,"Send OTP"))],8,D)])),p.value&&p.value.exists?(i(),l("div",te,[s("div",ae,[s("div",oe,[e[11]||(e[11]=s("svg",{class:"w-5 h-5 text-success",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1)),s("p",re," OTP already sent! Expires at "+h(p.value.expiresAt)+" ("+h(p.value.remainingMinutes)+" min remaining) ",1)])])])):_("",!0),p.value&&p.value.exists&&y.value?(i(),l("div",le,[s("button",{onClick:V,disabled:v.value>0||d.value,class:"text-accent hover:text-primary-400 text-sm font-medium transition-colors duration-fast disabled:opacity-50 disabled:cursor-not-allowed"},[v.value>0?(i(),l("span",ne," Resend OTP in "+h(v.value)+"s ",1)):(i(),l("span",de," Resend OTP "))],8,ie)])):_("",!0),e[14]||(e[14]=s("div",{class:"mt-6 text-center"},[s("p",{class:"text-text-2 text-sm"}," OTP will expire in 10 minutes. ")],-1)),s("div",ue,[k(T(M),{href:t.route("logout"),method:"post",as:"button",class:"text-text-2 text-sm underline transition duration-fast hover:text-accent"},{default:z(()=>[...e[12]||(e[12]=[B(" Cancel and Logout ",-1)])]),_:1},8,["href"])])])])],64))}},be=U(ce,[["__scopeId","data-v-3d672b29"]]);export{be as default};
