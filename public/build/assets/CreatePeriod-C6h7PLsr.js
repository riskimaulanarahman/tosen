import{u as M,c as U,r as S,m as N,a as o,b as u,h as a,i as E,w as p,e,d as x,k as z,q as y,t as d,o as l,F as f,j as _,v as m,A as g,G as L,n as J}from"./app-Bi7HOOmg.js";import{A as q}from"./AuthenticatedLayout-CosheEKI.js";import{_ as C}from"./Card.vue_vue_type_script_setup_true_lang-Bwwk7C6e.js";import{_ as k}from"./Button.vue_vue_type_script_setup_true_lang-CLgP9_cW.js";import{B as R}from"./Breadcrumb-WjWOs7bQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Z={class:"space-y-6"},Q={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},W={class:"flex flex-wrap gap-2 justify-end"},X={key:0,class:"bg-success-900/20 border border-success-700 text-success-100 p-4 rounded-lg"},Y={key:1,class:"bg-danger-900/20 border border-danger-700 text-danger-100 p-4 rounded-lg"},ee={key:2,class:"bg-yellow-100 border border-yellow-300 text-yellow-900 p-4 rounded-lg"},te={class:"list-disc ml-4 space-y-1"},se={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ae={class:"p-5 space-y-4"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},re={class:"flex items-center justify-between text-sm"},oe={class:"text-muted"},de={key:0,class:"text-xs text-danger"},ne={class:"p-5 space-y-4"},ie={class:"space-y-3"},ue=["value"],pe={class:"grid grid-cols-1 md:grid-cols-2 gap-3"},ce={class:"flex items-center justify-between text-sm"},me={class:"text-muted"},ye={key:0,class:"text-xs text-danger"},be={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ge={class:"p-5 space-y-4"},xe={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-3"},fe={class:"flex flex-col sm:flex-row gap-2"},_e=["value"],ve={class:"overflow-x-auto"},ke={class:"min-w-full divide-y divide-border text-sm"},he={class:"divide-y divide-border"},we={key:0,class:"text-center text-muted"},Pe={class:"px-4 py-3"},Ce={class:"space-y-1"},Ve={class:"flex items-center text-xs text-muted"},Be=["checked","onChange"],je={class:"flex items-center text-xs text-muted"},Ue=["checked","onChange"],De={class:"px-4 py-3"},Fe={class:"font-semibold text-text"},Se={class:"text-xs text-muted"},Te={class:"px-4 py-3"},$e={class:"p-5 space-y-4"},Ae={class:"space-y-3"},Ge={class:"font-semibold"},Ne={class:"text-xs text-muted"},Le={key:0,class:"text-sm text-muted text-center"},ze={__name:"CreatePeriod",props:{employees:{type:Array,default:()=>[]},outlets:{type:Array,default:()=>[]},payrollPeriods:{type:Array,default:()=>[]}},setup(V){const D=V,O=[{name:"Dashboard",href:route("dashboard")},{name:"Manajemen Penggajian",href:route("payroll.index")},{name:"Buat Payroll"}],H=M(),h=U(()=>H.props.flash||{}),T=U(()=>{var n;return((n=h.value)==null?void 0:n.payroll_partial_errors)||[]}),B=S(!1),v=S(""),w=S(""),$=U(()=>D.employees.filter(n=>{const t=!w.value||Number(n.outlet_id)===Number(w.value),c=!v.value||n.name.toLowerCase().includes(v.value.toLowerCase())||(n.email||"").toLowerCase().includes(v.value.toLowerCase());return t&&c})),r=N({name:"",start_date:"",end_date:"",basic_rate:"",overtime_rate:1.5,notes:"",user_ids:[]}),i=N({payroll_period_id:"",start_date:"",end_date:"",user_ids:[]}),F=n=>{if(!n)return"-";const t=typeof n=="string"?n.split("T")[0].split(" ")[0]:n,c=new Date(`${t}T00:00:00`);return new Intl.DateTimeFormat("id-ID",{year:"numeric",month:"short",day:"numeric",timeZone:"Asia/Jakarta"}).format(c)},A=(n,t="create")=>{const c=t==="create"?r:i;c.user_ids.includes(n)?c.user_ids=c.user_ids.filter(j=>j!==n):c.user_ids=[...c.user_ids,n]},I=()=>{r.post(route("payroll.create.period"),{preserveScroll:!0,onSuccess:()=>{r.reset(),w.value="",v.value=""}})},K=()=>{i.post(route("payroll.generate"),{preserveScroll:!0,onSuccess:()=>i.reset()})},G=U(()=>D.payrollPeriods.slice(0,5));return(n,t)=>(l(),o(f,null,[u(a(E),{title:"Buat Payroll"}),u(q,null,{breadcrumb:p(()=>[u(R,{items:O})]),default:p(()=>{var c,j;return[e("div",Z,[e("div",Q,[t[15]||(t[15]=e("div",null,[e("h1",{class:"text-3xl font-bold text-text"}," Pengaturan Periode Payroll "),e("p",{class:"text-muted"}," Buat periode baru, pilih karyawan, dan jalankan proses payroll terjadwal. ")],-1)),e("div",W,[u(k,{variant:"ghost",onClick:t[0]||(t[0]=s=>B.value=!B.value)},{default:p(()=>[y(d(B.value?"Tutup Help":"Help"),1)]),_:1}),u(k,{variant:"secondary",href:n.route("payroll.index")},{default:p(()=>[...t[14]||(t[14]=[y(" Kembali ke daftar ",-1)])]),_:1},8,["href"])])]),(c=h.value)!=null&&c.success?(l(),o("div",X,d(h.value.success),1)):x("",!0),(j=h.value)!=null&&j.error?(l(),o("div",Y,d(h.value.error),1)):x("",!0),T.value.length?(l(),o("div",ee,[t[16]||(t[16]=e("p",{class:"font-semibold mb-2"},"Sebagian payroll gagal dibuat:",-1)),e("ul",te,[(l(!0),o(f,null,_(T.value,s=>{var b;return l(),o("li",{key:s.user_id},d(((b=D.employees.find(P=>P.id===s.user_id))==null?void 0:b.name)||`ID ${s.user_id}`)+" — "+d(s.error),1)}),128))])])):x("",!0),B.value?(l(),z(C,{key:3},{default:p(()=>[...t[17]||(t[17]=[e("div",{class:"p-4 space-y-2 text-sm text-text"},[e("p",{class:"font-semibold"},"Panduan pengisian:"),e("ul",{class:"list-disc ml-5 space-y-1 text-muted"},[e("li",null,"Isi nama periode, tanggal mulai/akhir, basic rate, dan overtime rate (pengali lembur)."),e("li",null,"Tanpa memilih karyawan, sistem otomatis menyertakan semua karyawan yang dimiliki."),e("li",null,'Pilih karyawan di tabel; tombol "Periode" untuk membuat periode baru sekaligus payroll, tombol "Generate" untuk menambah payroll pada periode yang sudah ada.'),e("li",null,"Jika tidak isi tanggal di form Generate, sistem memakai rentang tanggal periode terpilih."),e("li",null,"Periksa pesan error parsial bila ada karyawan yang gagal diproses (misal tidak ada data absensi).")])],-1)])]),_:1})):x("",!0),e("div",se,[u(C,null,{default:p(()=>[e("div",ae,[t[20]||(t[20]=e("h2",{class:"text-lg font-semibold text-text"}," Buat Periode Payroll ",-1)),e("div",le,[m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>a(r).name=s),type:"text",placeholder:"Nama periode",class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg"},null,512),[[g,a(r).name]]),m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>a(r).basic_rate=s),type:"number",min:"0",placeholder:"Basic rate",class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg"},null,512),[[g,a(r).basic_rate]]),m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>a(r).start_date=s),type:"date",class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg"},null,512),[[g,a(r).start_date]]),m(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>a(r).end_date=s),type:"date",class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg"},null,512),[[g,a(r).end_date]]),m(e("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>a(r).overtime_rate=s),type:"number",min:"1",step:"0.1",placeholder:"Overtime multiplier",class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg"},null,512),[[g,a(r).overtime_rate]]),m(e("textarea",{"onUpdate:modelValue":t[6]||(t[6]=s=>a(r).notes=s),rows:"2",class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg col-span-1 md:col-span-2",placeholder:"Catatan tambahan"},null,512),[[g,a(r).notes]])]),e("div",re,[e("p",oe,[t[18]||(t[18]=y(" Karyawan dipilih: ",-1)),e("strong",null,d(a(r).user_ids.length),1)]),u(k,{size:"sm",variant:"ghost",onClick:t[7]||(t[7]=s=>a(r).user_ids=[])},{default:p(()=>[...t[19]||(t[19]=[y(" Hapus pilihan ",-1)])]),_:1})]),u(k,{class:"w-full",disabled:a(r).processing,onClick:I},{default:p(()=>[y(d(a(r).processing?"Menyimpan...":"Buat Periode"),1)]),_:1},8,["disabled"]),Object.keys(a(r).errors).length?(l(),o("div",de,[(l(!0),o(f,null,_(a(r).errors,(s,b)=>(l(),o("div",{key:b},d(s),1))),128))])):x("",!0)])]),_:1}),u(C,null,{default:p(()=>[e("div",ne,[t[24]||(t[24]=e("h2",{class:"text-lg font-semibold text-text"}," Generate Payroll ",-1)),e("div",ie,[m(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>a(i).payroll_period_id=s),class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg"},[t[21]||(t[21]=e("option",{value:""},"Pilih Periode",-1)),(l(!0),o(f,null,_(V.payrollPeriods,s=>(l(),o("option",{key:s.id,value:s.id},d(s.name)+" · "+d(F(s.start_date)),9,ue))),128))],512),[[L,a(i).payroll_period_id]]),e("div",pe,[m(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>a(i).start_date=s),type:"date",class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg"},null,512),[[g,a(i).start_date]]),m(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>a(i).end_date=s),type:"date",class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg"},null,512),[[g,a(i).end_date]])]),e("div",ce,[e("p",me,[t[22]||(t[22]=y(" Karyawan dipilih: ",-1)),e("strong",null,d(a(i).user_ids.length),1)]),u(k,{size:"sm",variant:"ghost",onClick:t[11]||(t[11]=s=>a(i).user_ids=[])},{default:p(()=>[...t[23]||(t[23]=[y(" Hapus pilihan ",-1)])]),_:1})]),u(k,{class:"w-full",disabled:a(i).processing,onClick:K},{default:p(()=>[y(d(a(i).processing?"Memproses...":"Generate Payroll"),1)]),_:1},8,["disabled"])]),Object.keys(a(i).errors).length?(l(),o("div",ye,[(l(!0),o(f,null,_(a(i).errors,(s,b)=>(l(),o("div",{key:b},d(s),1))),128))])):x("",!0)])]),_:1})]),e("div",be,[u(C,{class:"lg:col-span-2"},{default:p(()=>[e("div",ge,[e("div",xe,[t[26]||(t[26]=e("div",null,[e("h2",{class:"text-lg font-semibold text-text"}," Pilih Karyawan "),e("p",{class:"text-sm text-muted"}," Filter berdasarkan outlet atau nama. ")],-1)),e("div",fe,[m(e("input",{"onUpdate:modelValue":t[12]||(t[12]=s=>v.value=s),type:"text",placeholder:"Cari nama/email",class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg"},null,512),[[g,v.value]]),m(e("select",{"onUpdate:modelValue":t[13]||(t[13]=s=>w.value=s),class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg"},[t[25]||(t[25]=e("option",{value:""},"Semua Outlet",-1)),(l(!0),o(f,null,_(V.outlets,s=>(l(),o("option",{key:s.id,value:s.id},d(s.name),9,_e))),128))],512),[[L,w.value]])])]),e("div",ve,[e("table",ke,[t[30]||(t[30]=e("thead",null,[e("tr",{class:"text-left text-xs uppercase text-muted"},[e("th",{class:"px-4 py-3"},"Pilih"),e("th",{class:"px-4 py-3"},"Karyawan"),e("th",{class:"px-4 py-3"},"Outlet")])],-1)),e("tbody",he,[$.value.length===0?(l(),o("tr",we,[...t[27]||(t[27]=[e("td",{colspan:"3",class:"px-4 py-6"}," Tidak ada karyawan yang cocok. ",-1)])])):x("",!0),(l(!0),o(f,null,_($.value,s=>{var b;return l(),o("tr",{key:s.id},[e("td",Pe,[e("div",Ce,[e("label",Ve,[e("input",{type:"checkbox",class:"mr-2",checked:a(r).user_ids.includes(s.id),onChange:P=>A(s.id,"create")},null,40,Be),t[28]||(t[28]=y(" Periode ",-1))]),e("label",je,[e("input",{type:"checkbox",class:"mr-2",checked:a(i).user_ids.includes(s.id),onChange:P=>A(s.id,"generate")},null,40,Ue),t[29]||(t[29]=y(" Generate ",-1))])])]),e("td",De,[e("p",Fe,d(s.name),1),e("p",Se,d(s.email),1)]),e("td",Te,d(((b=V.outlets.find(P=>P.id===s.outlet_id))==null?void 0:b.name)||"Tidak ada outlet"),1)])}),128))])])])])]),_:1}),u(C,null,{default:p(()=>[e("div",$e,[t[31]||(t[31]=e("h2",{class:"text-lg font-semibold text-text"}," Riwayat Periode ",-1)),e("div",Ae,[(l(!0),o(f,null,_(G.value,s=>(l(),o("div",{key:s.id,class:"p-3 bg-surface-2 rounded-lg border border-border"},[e("p",Ge,d(s.name),1),e("p",Ne,d(F(s.start_date))+" - "+d(F(s.end_date)),1),e("span",{class:J(["inline-flex mt-2 px-2 py-1 rounded-full text-xs",s.status==="active"?"bg-primary-100 text-primary-800":s.status==="completed"?"bg-success-100 text-success-800":"bg-gray-100 text-gray-700"])},d(s.status),3)]))),128)),G.value.length===0?(l(),o("p",Le," Belum ada periode yang tercatat. ")):x("",!0)])])]),_:1})])])]}),_:1})],64))}};export{ze as default};
