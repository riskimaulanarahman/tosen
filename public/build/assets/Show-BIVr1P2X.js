import{c as S,u as J,r as U,m as D,a as d,b as i,h as s,i as W,w as u,e,d as c,k as Z,t as a,q as p,l as $,o as n,v,F as T,j as N,G as Q,A as h,n as X}from"./app-LYI9ClMC.js";import{A as Y}from"./AuthenticatedLayout-Cl7_EZZK.js";import{_ as g}from"./Card.vue_vue_type_script_setup_true_lang-T8rMks-o.js";import{_ as f}from"./Button.vue_vue_type_script_setup_true_lang-PLCSh3nU.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={class:"space-y-6"},te={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},se={class:"text-2xl font-bold text-text",style:{"font-family":"'Oswald', sans-serif"}},le={class:"text-muted"},ae={class:"flex flex-wrap gap-2"},oe={key:0,class:"bg-success-900/20 border border-success-700 text-success-100 p-4 rounded-lg"},re={key:1,class:"bg-danger-900/20 border border-danger-700 text-danger-100 p-4 rounded-lg"},ne={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},de={class:"p-4"},ie={class:"text-3xl font-bold text-text"},ue={class:"p-4"},pe={class:"text-3xl font-bold text-success"},me={class:"p-4"},ce={class:"text-3xl font-bold text-info"},xe={class:"p-6 space-y-4"},ye={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},fe={class:"space-y-1"},be=["value"],_e={class:"space-y-1"},ve={class:"space-y-1"},ge={key:0,class:"text-xs text-danger"},he={key:1,class:"text-xs text-danger"},ke={key:2,class:"text-xs text-danger"},Pe={class:"p-6 space-y-4"},we={key:0,class:"text-xs text-danger"},je={class:"p-6 space-y-4"},Ce={class:"overflow-x-auto"},Se={class:"min-w-full divide-y divide-border text-sm"},Te={class:"divide-y divide-border"},Ve={key:0},Be={class:"px-4 py-3"},De={class:"font-semibold text-text"},Ne={class:"text-xs text-muted"},Ee={class:"px-4 py-3"},Fe={class:"text-xs text-muted"},Ae={class:"text-xs text-muted"},Me={class:"px-4 py-3"},Ue={class:"px-4 py-3"},$e={class:"px-4 py-3"},Ie={key:0,class:"text-xs text-muted"},ze={key:1,class:"text-xs text-muted space-y-1"},Ke={class:"px-4 py-3"},Oe={class:"mb-2 flex flex-col gap-2"},Ge={key:0,class:"space-y-2"},He={class:"space-y-1"},Le={class:"space-y-1"},Re={class:"space-y-1"},qe={class:"flex gap-2"},Je={key:0,class:"text-xs text-danger"},We={key:1,class:"text-xs text-danger"},Ze={key:2,class:"text-xs text-danger"},Qe={key:1,class:"space-y-2"},Xe={class:"text-xs text-muted"},at={__name:"Show",props:{payrollPeriod:{type:Object,required:!0}},setup(x){const k=x,P=S(()=>{var r;return((r=k.payrollPeriod)==null?void 0:r.payroll_records)||[]}),I=J(),w=S(()=>I.props.flash||{}),j=U(!1),b=D({notes:""}),m=D({payment_method:"",payment_reference:"",paid_at:""}),z=[{value:"cash",label:"Cash"},{value:"transfer",label:"Transfer Bank"},{value:"ewallet",label:"E-Wallet"}],o=D({payroll_record_id:null,bonus:"",other_deductions:"",notes:""}),V=U(null),_=r=>r==null?"Rp 0":new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",maximumFractionDigits:0}).format(Number(r)),B=r=>{if(!r)return"-";const t=typeof r=="string"?r.split("T")[0].split(" ")[0]:r,C=new Date(`${t}T00:00:00`);return new Intl.DateTimeFormat("id-ID",{year:"numeric",month:"short",day:"numeric",timeZone:"Asia/Jakarta"}).format(C)},K=S(()=>P.value.reduce((r,t)=>r+Number(t.total_pay||0)-Number(t.tax_deduction||0)-Number(t.other_deductions||0),0)),O=S(()=>P.value.length),G=()=>{b.post(route("payroll.approve",k.payrollPeriod.id),{preserveScroll:!0,onSuccess:()=>b.reset()})},H=()=>{m.post(route("payroll.process.payments",k.payrollPeriod.id),{preserveScroll:!0})},L=()=>{window.location.href=route("payroll.export",k.payrollPeriod.id)},R=r=>{V.value=r.id,o.payroll_record_id=r.id,o.bonus=r.bonus??0,o.other_deductions=r.other_deductions??0,o.notes=r.notes??""},E=()=>{V.value=null,o.reset(),o.clearErrors()},q=()=>{o.payroll_record_id&&o.put(route("payroll.record.adjust",o.payroll_record_id),{preserveScroll:!0,onSuccess:()=>{E()}})};return(r,t)=>(n(),d(T,null,[i(s(W),{title:`Detail Payroll: ${x.payrollPeriod.name}`},null,8,["title"]),i(Y,null,{default:u(()=>{var C,F;return[e("div",ee,[e("div",te,[e("div",null,[e("h1",se,a(x.payrollPeriod.name),1),e("p",le," Periode "+a(B(x.payrollPeriod.start_date))+" - "+a(B(x.payrollPeriod.end_date)),1)]),e("div",ae,[i(f,{variant:"ghost",onClick:t[0]||(t[0]=l=>j.value=!j.value)},{default:u(()=>[p(a(j.value?"Tutup Help":"Help"),1)]),_:1}),i(s($),{href:r.route("payroll.index")},{default:u(()=>[i(f,{variant:"secondary"},{default:u(()=>[...t[8]||(t[8]=[p("Kembali",-1)])]),_:1})]),_:1},8,["href"]),i(f,{variant:"ghost",onClick:L},{default:u(()=>[...t[9]||(t[9]=[p("Export CSV",-1)])]),_:1}),i(f,{variant:"ghost",href:r.route("payroll.export.summary",x.payrollPeriod.id)},{default:u(()=>[...t[10]||(t[10]=[p(" Export Summary ",-1)])]),_:1},8,["href"]),i(f,{variant:"primary",disabled:s(b).processing||x.payrollPeriod.status!=="active",onClick:G},{default:u(()=>[p(a(s(b).processing?"Menyetujui...":"Setujui Periode"),1)]),_:1},8,["disabled"]),i(f,{variant:"success",disabled:s(m).processing||x.payrollPeriod.status!=="completed",onClick:H},{default:u(()=>[p(a(s(m).processing?"Memproses...":"Proses Pembayaran"),1)]),_:1},8,["disabled"])])]),(C=w.value)!=null&&C.success?(n(),d("div",oe,a(w.value.success),1)):c("",!0),(F=w.value)!=null&&F.error?(n(),d("div",re,a(w.value.error),1)):c("",!0),j.value?(n(),Z(g,{key:2},{default:u(()=>[...t[11]||(t[11]=[e("div",{class:"p-4 space-y-2 text-sm text-text"},[e("p",{class:"font-semibold"},"Cara menggunakan halaman ini:"),e("ul",{class:"list-disc ml-5 space-y-1 text-muted"},[e("li",null,[p(" Pastikan status periode "),e("strong",null,"active"),p(' sebelum klik "Setujui Periode" (akan menjadi '),e("strong",null,"completed"),p("). ")]),e("li",null,[p(' "Proses Pembayaran" hanya aktif setelah status menjadi '),e("strong",null,"completed"),p("; mengubah seluruh record approved menjadi "),e("strong",null,"paid"),p(". ")]),e("li",null,' Gunakan "Export CSV" untuk mengunduh rekap gaji dan lembur. '),e("li",null," Periksa tabel payroll untuk melihat potongan pajak, potongan lain, dan detail lembur per karyawan. ")])],-1)])]),_:1})):c("",!0),e("div",ne,[i(g,null,{default:u(()=>[e("div",de,[t[12]||(t[12]=e("p",{class:"text-sm text-muted"},"Total Karyawan",-1)),e("p",ie,a(O.value),1)])]),_:1}),i(g,null,{default:u(()=>[e("div",ue,[t[13]||(t[13]=e("p",{class:"text-sm text-muted"},"Total Gaji Bersih",-1)),e("p",pe,a(_(K.value)),1)])]),_:1}),i(g,null,{default:u(()=>[e("div",me,[t[14]||(t[14]=e("p",{class:"text-sm text-muted"},"Status Periode",-1)),e("p",ce,a(x.payrollPeriod.status),1)])]),_:1})]),i(g,null,{default:u(()=>[e("div",xe,[t[19]||(t[19]=e("div",{class:"flex items-center justify-between"},[e("h2",{class:"text-lg font-semibold text-text"}," Pembayaran "),e("p",{class:"text-xs text-muted"},' Tentukan metode/tanggal sebelum "Proses Pembayaran" ')],-1)),e("div",ye,[e("div",fe,[t[16]||(t[16]=e("label",{class:"text-sm text-muted"},"Metode",-1)),v(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>s(m).payment_method=l),class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg"},[t[15]||(t[15]=e("option",{value:""},"Pilih metode",-1)),(n(),d(T,null,N(z,l=>e("option",{key:l.value,value:l.value},a(l.label),9,be)),64))],512),[[Q,s(m).payment_method]])]),e("div",_e,[t[17]||(t[17]=e("label",{class:"text-sm text-muted"},"Referensi/No. Transaksi",-1)),v(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>s(m).payment_reference=l),type:"text",class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg",placeholder:"Nomor transfer/nota"},null,512),[[h,s(m).payment_reference]])]),e("div",ve,[t[18]||(t[18]=e("label",{class:"text-sm text-muted"},"Tanggal Bayar",-1)),v(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>s(m).paid_at=l),type:"date",class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg"},null,512),[[h,s(m).paid_at]])])]),s(m).errors.payment_method?(n(),d("div",ge,a(s(m).errors.payment_method),1)):c("",!0),s(m).errors.payment_reference?(n(),d("div",he,a(s(m).errors.payment_reference),1)):c("",!0),s(m).errors.paid_at?(n(),d("div",ke,a(s(m).errors.paid_at),1)):c("",!0)])]),_:1}),i(g,null,{default:u(()=>[e("div",Pe,[t[20]||(t[20]=e("h2",{class:"text-lg font-semibold text-text"}," Catatan Persetujuan ",-1)),v(e("textarea",{"onUpdate:modelValue":t[4]||(t[4]=l=>s(b).notes=l),rows:"3",class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg",placeholder:"Catatan untuk approval..."},null,512),[[h,s(b).notes]]),s(b).errors.notes?(n(),d("div",we,a(s(b).errors.notes),1)):c("",!0)])]),_:1}),i(g,null,{default:u(()=>[e("div",je,[t[30]||(t[30]=e("div",{class:"flex flex-col md:flex-row md:items-center md:justify-between gap-2"},[e("div",null,[e("h2",{class:"text-lg font-semibold text-text"}," Daftar Payroll "),e("p",{class:"text-sm text-muted"}," Semua karyawan pada periode ini ")])],-1)),e("div",Ce,[e("table",Se,[t[29]||(t[29]=e("thead",null,[e("tr",{class:"text-left text-xs uppercase text-muted"},[e("th",{class:"px-4 py-3"},"Karyawan"),e("th",{class:"px-4 py-3"},"Total"),e("th",{class:"px-4 py-3"},"Status"),e("th",{class:"px-4 py-3"},"Diterima"),e("th",{class:"px-4 py-3"},"Overtime"),e("th",{class:"px-4 py-3"},"Aksi")])],-1)),e("tbody",Te,[P.value.length===0?(n(),d("tr",Ve,[...t[21]||(t[21]=[e("td",{colspan:"6",class:"px-4 py-6 text-center text-muted"}," Belum ada payroll yang dihasilkan. ",-1)])])):c("",!0),(n(!0),d(T,null,N(P.value,l=>{var A,M;return n(),d("tr",{key:l.id,class:"align-top"},[e("td",Be,[e("p",De,a(((A=l.user)==null?void 0:A.name)||`Karyawan #${l.user_id}`),1),e("p",Ne,a(((M=l.user)==null?void 0:M.email)||"-"),1)]),e("td",Ee,[e("p",null,a(_(l.total_pay)),1),e("p",Fe," Pajak: "+a(_(l.tax_deduction))+" • Potongan lain: "+a(_(l.other_deductions)),1),e("p",Ae," Bonus: "+a(_(l.bonus)),1)]),e("td",Me,[e("span",{class:X(["inline-flex px-2 py-1 rounded-full text-xs",l.status==="paid"?"bg-success-100 text-success-800":l.status==="approved"?"bg-primary-100 text-primary-800":"bg-gray-100 text-gray-600"])},a(l.status),3)]),e("td",Ue,a(_(l.total_pay-l.tax_deduction-l.other_deductions)),1),e("td",$e,[(l.overtime_records||[]).length===0?(n(),d("div",Ie," Tidak ada lembur ")):(n(),d("ul",ze,[(n(!0),d(T,null,N(l.overtime_records,y=>(n(),d("li",{key:y.id},a(B(y.date))+" • "+a(y.overtime_minutes)+" menit ",1))),128))]))]),e("td",Ke,[e("div",Oe,[i(s($),{href:r.route("payroll.record.slip",[l.id,{view:"html"}]),target:"_blank",rel:"noopener"},{default:u(()=>[i(f,{size:"sm",variant:"secondary",class:"w-full"},{default:u(()=>[...t[22]||(t[22]=[p(" Lihat Slip ",-1)])]),_:1})]),_:1},8,["href"])]),V.value===l.id?(n(),d("div",Ge,[e("div",He,[t[23]||(t[23]=e("label",{class:"text-xs text-muted"},"Tunjangan/Bonus",-1)),v(e("input",{"onUpdate:modelValue":t[5]||(t[5]=y=>s(o).bonus=y),type:"number",min:"0",class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg"},null,512),[[h,s(o).bonus,void 0,{number:!0}]])]),e("div",Le,[t[24]||(t[24]=e("label",{class:"text-xs text-muted"},"Potongan lain",-1)),v(e("input",{"onUpdate:modelValue":t[6]||(t[6]=y=>s(o).other_deductions=y),type:"number",min:"0",class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg"},null,512),[[h,s(o).other_deductions,void 0,{number:!0}]])]),e("div",Re,[t[25]||(t[25]=e("label",{class:"text-xs text-muted"},"Catatan",-1)),v(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=y=>s(o).notes=y),rows:"2",class:"w-full px-3 py-2 bg-surface-2 border border-border rounded-lg"},null,512),[[h,s(o).notes]])]),e("div",qe,[i(f,{size:"sm",disabled:s(o).processing,onClick:q},{default:u(()=>[p(a(s(o).processing?"Menyimpan...":"Simpan"),1)]),_:1},8,["disabled"]),i(f,{size:"sm",variant:"secondary",onClick:E},{default:u(()=>[...t[26]||(t[26]=[p(" Batal ",-1)])]),_:1})]),s(o).errors.bonus?(n(),d("div",Je,a(s(o).errors.bonus),1)):c("",!0),s(o).errors.other_deductions?(n(),d("div",We,a(s(o).errors.other_deductions),1)):c("",!0),s(o).errors.notes?(n(),d("div",Ze,a(s(o).errors.notes),1)):c("",!0)])):(n(),d("div",Qe,[e("div",Xe,[p(" Bonus: "+a(_(l.bonus)),1),t[27]||(t[27]=e("br",null,null,-1)),p(" Potongan: "+a(_(l.other_deductions)),1)]),i(f,{size:"sm",variant:"ghost",onClick:y=>R(l),disabled:x.payrollPeriod.status==="paid"},{default:u(()=>[...t[28]||(t[28]=[p(" Edit ",-1)])]),_:1},8,["onClick","disabled"])]))])])}),128))])])])])]),_:1})])]}),_:1})],64))}};export{at as default};
